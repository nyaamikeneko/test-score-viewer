# 学年テスト結果 可視化・分析サイト

## 1. 概要

本プロジェクトは、学年全体のテスト結果を匿名で収集し、参加者が自身の成績順位や全体の中での位置を直感的に把握できるウェブアプリケーションです。Googleスプレッドシートを簡易的なデータベースとして利用し、サーバーレス構成でリアルタイムなデータ分析体験を提供します。

## 2. 主な機能

* **匿名での点数投稿**: サイト内のフォームから直接テストの点数を投稿可能。
* **統計情報の自動算出**: 回答者数、平均点、中央値、標準偏差、最高点、最低点をリアルタイムで自動計算・表示。
* **点数分布の可視化**: 投稿された全データをもとに、点数分布のヒストグラムを動的に描画。
* **インタラクティブな順位確認**: 任意の点数を入力すると、全体の中での順位、上位パーセント、およびグラフ上での位置がハイライト表示される。
* **二重投稿の抑制**: `localStorage`を利用し、同一ブラウザからの複数回の投稿を抑制。

## 3. システム構成

本アプリケーションは、以下のコンポーネントで構成されるサーバーレスアーキテクチャを採用しています。

* **フロントエンド**: `HTML`, `CSS`, `JavaScript`
    * ユーザーインターフェースの提供、データの視覚化（Chart.jsを利用）、およびバックエンドAPIとの非同期通信を担当。
* **バックエンド (API)**: `Google Apps Script (GAS)`
    * スプレッドシートへのデータ書き込み (`doPost`) と、データの読み出し (`doGet`) を行うWeb APIとして機能。サーバーサイドでの入力値検証も担当。
* **データベース**: `Googleスプレッドシート`
    * 投稿された点数データを時系列で記録する簡易的なデータベースとして利用。

#### データフロー
1.  **データ投稿時**: ユーザーがサイトで点数を入力 → フロントエンドが`POST`リクエストをGASに送信 → GASがデータを検証し、スプレッドシートに追記。
2.  **データ表示時**: サイト読み込み時 → フロントエンドが`GET`リクエストをGASに送信 → GASがスプレッドシートから全データを読み出し、JSON形式でフロントエンドに返却 → フロントエンドが受信したデータを整形し、統計情報とグラフを描画。

## 4. 使用技術

* **フロントエンド**:
    * HTML5
    * CSS3
    * JavaScript (ES6+)
    * Chart.js (グラフ描画ライブラリ)
* **バックエンド**:
    * Google Apps Script
* **データベース**:
    * Google Sheets
* **ホスティング**:
    * GitHub Pages

## 5. セットアップ手順

1.  **Googleフォームとスプレッドシートの準備**:
    * 点数入力用のGoogleフォームを作成し、回答の保存先として新規にGoogleスプレッドシートを作成する。
2.  **Google Apps Scriptのデプロイ**:
    * スプレッドシートに紐づく形でGASプロジェクトを新規作成し、提供された`doGet`および`doPost`関数を記述する。
    * ウェブアプリとしてデプロイし、「アクセスできるユーザー」を「全員」に設定する。発行されたウェブアプリURLをコピーする。
3.  **フロントエンドの設定**:
    * `script.js`ファイル内の`GAS_URL`定数に、上記で取得したウェブアプリURLを設定する。
    * `index.html`, `style.css`, `script.js`の3ファイルを静的ホスティングサーバー（GitHub Pagesなど）に配置する。

## 6. 開発経緯と主な改善点

本プロジェクトは、初期のシンプルな閲覧機能から、ユーザーのフィードバックと技術的な探求に基づき、段階的に機能改善を重ねてきました。

* **v1.0: 基本機能の実装**
    * Googleスプレッドシートのデータを読み取り、統計情報とグラフを表示する閲覧専用サイトとして構築。順位確認機能もこの段階で実装。

* **v1.1: ユーザー体験の向上とバグ修正**
    * **順位計算ロジックの改善**: データが少ない場合の順位・パーセント計算の不具合を修正。
    * **グラフの動的化**: 全範囲（200-800点）を固定で表示していたグラフのX軸を、データが存在する範囲に自動でズームインするよう変更し、視認性を大幅に向上。
    * **レイアウト調整**: ユーザーの視線の流れを考慮し、統計情報ブロックの配置を下部に変更。モバイル表示時のグラフの縦横比を調整。

* **v1.2: データ投稿機能の実装**
    * Googleフォームへの依存をなくし、サイト内から直接点数を投稿できる機能を追加。
    * GASに`doPost`関数を実装し、データの書き込みに対応。フロントエンドは`fetch API`による`POST`リクエスト送信機能を実装し、読み書き両対応のアプリケーションに進化した。

* **v1.3: 二重投稿防止機能とインタラクション改善**
    * `localStorage`を利用し、同一ブラウザからの投稿を一度に制限する機能を追加。
    * 一度投稿したユーザーは、フォームが「順位確認専用モード」に切り替わり、二重投稿することなく何度でも順位を確認できるUXを実装。

* **v1.4: セキュリティと堅牢性の向上**
    * **サーバーサイド・バリデーションの徹底**: クライアントサイドでの入力値制限（200-800点）は開発者ツール等で回避可能であると想定。GAS側でも厳密な数値範囲チェックを行うことで、不正なデータ（範囲外の数値や悪意のあるスクリプト等）の書き込みを完全にブロックする設計を確立。これにより、XSS（クロスサイトスクリプティング）などの脆弱性への対策も実現した。
    * **デバッグとコード修正**: 開発過程で発生したJavaScriptの構文エラーや、GASのデータ書き込み列のズレなどを、ブラウザのデベロッパーツールを用いて特定・修正。

## 7. 今後の展望

* 簡易的なデータベースとしてのGoogleスプレッドシートから、より高速かつ高機能なBaaS（Backend as a Service）である**Firebase (Firestore)** への移行。
* Firebase Authenticationを利用した、より厳密な（ただし匿名性は失われる）ユーザーごとの二重投稿防止機能の実装。
* reCAPTCHAの導入による、ボットからの大量投稿（荒らし）対策。
